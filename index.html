<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ä»£è¡Œæ–™é‡‘è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f4f4f4; }
    input, button { padding: 0.5em; font-size: 1em; }
    .result { margin-top: 1em; font-weight: bold; }

    .input-group {
      display: flex;
      gap: 1em;
      align-items: center;
      flex-wrap: wrap;
    }

    @media screen and (max-width: 600px) {
      .input-group {
        flex-direction: column;
        align-items: flex-start;
      }

      .input-group label,
      .input-group input {
        width: 100%;
      }
    }

    .table-container,
    .history-container {
      margin-top: 2em;
      max-height: 300px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      background: #fff;
      padding: 1em;
    }

    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: right; }
    th { background-color: #eee; position: sticky; top: 0; }
    caption { text-align: left; font-weight: bold; margin-bottom: 0.5em; }
  </style>
</head>
<body>
  <h1>ä»£è¡Œæ–™é‡‘è¨ˆç®—</h1>
  <div class="input-group">
    <label for="distance">èµ°è¡Œè·é›¢ï¼ˆkmï¼‰:</label>
    <input type="number" id="distance" min="0" step="0.1">
    <label for="taxRate">æ¶ˆè²»ç¨ç‡ï¼ˆ%ï¼‰:</label>
    <input type="number" id="taxRate" min="0" step="0.1" value="10">
  </div>
  <button onclick="calculate()">è¨ˆç®—ã™ã‚‹</button>
  <div class="result" id="result"></div>

  <div class="table-container">
    <table>
      <caption>ğŸ“Š æ–™é‡‘æ—©è¦‹è¡¨ï¼ˆ0ã€œ100kmï¼‰</caption>
      <thead>
        <tr>
          <th>è·é›¢ (km)</th>
          <th>ç¨è¾¼æ–™é‡‘ (å††)</th>
          <th>ç¨æŠœä¾¡æ ¼ (å††)</th>
          <th>æ¶ˆè²»ç¨é¡ (å††)</th>
        </tr>
      </thead>
      <tbody id="fareTable"></tbody>
    </table>
  </div>

  <div class="history-container">
    <h2>ğŸ“ è¨ˆç®—å±¥æ­´ (ä¸€æ™‚ä¿å­˜)</h2>
    <b>æ–°ã—ã„é †</b>
    <table>
      <thead>
        <tr>
          <th>è·é›¢ (km)</th>
          <th>ç¨ç‡ (%)</th>
          <th>ç¨è¾¼ (å††)</th>
          <th>ç¨æŠœ (å††)</th>
          <th>æ¶ˆè²»ç¨ (å††)</th>
        </tr>
      </thead>
      <tbody id="historyTable"></tbody>
    </table>
  </div>

  <script>
    const baseDistance = 4;
    const baseFare = 1200;
    const extraPerKm = 200;

    function calculate() {
      const km = parseFloat(document.getElementById('distance').value);
      const taxRate = parseFloat(document.getElementById('taxRate').value);
      if (isNaN(km) || km < 0 || isNaN(taxRate) || taxRate < 0) {
        document.getElementById('result').textContent = "æ­£ã—ã„è·é›¢ã¨ç¨ç‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      const extraKm = Math.floor(km) > baseDistance ? Math.floor(km) - baseDistance : 0;
      const total = baseFare + extraKm * extraPerKm;
      const divisor = 1 + (taxRate / 100);
      const cost = Math.floor(total / divisor);
      const tax = total - cost;

      document.getElementById('result').innerHTML = `
        åˆè¨ˆæ–™é‡‘ï¼š${Math.floor(total).toLocaleString()} å††<br>
        â”” ç¨æŠœä¾¡æ ¼ï¼š${cost.toLocaleString()} å††<br>
        â”” æ¶ˆè²»ç¨é¡ï¼š${tax.toLocaleString()} å††
      `;

      const historyRow = `<tr>
        <td>${km}</td>
        <td>${taxRate}</td>
        <td>${Math.floor(total).toLocaleString()}</td>
        <td>${cost.toLocaleString()}</td>
        <td>${tax.toLocaleString()}</td>
      </tr>`;
      document.getElementById('historyTable').insertAdjacentHTML('beforeend', historyRow);
    }

    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        calculate();
      }
    });

    function generateTable() {
      const table = document.getElementById('fareTable');
      const taxRate = parseFloat(document.getElementById('taxRate').value);
      const divisor = 1 + (taxRate / 100);
      table.innerHTML = "";

      for (let km = 0; km <= 100; km++) {
        const extraKm = km > baseDistance ? km - baseDistance : 0;
        const total = baseFare + extraKm * extraPerKm;
        const cost = Math.floor(total / divisor);
        const tax = total - cost;
        const row = `<tr>
          <td>${km}</td>
          <td>${Math.floor(total).toLocaleString()}</td>
          <td>${cost.toLocaleString()}</td>
          <td>${tax.toLocaleString()}</td>
        </tr>`;
        table.insertAdjacentHTML('beforeend', row);
      }
    }

    generateTable();
    document.getElementById('taxRate').addEventListener('input', generateTable);
  </script>
</body>
</html>