<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>代行料金計算ツール</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background: #f4f4f4; }
    input, button { padding: 0.5em; font-size: 1em; }
    .result { margin-top: 1em; font-weight: bold; }

    .input-group {
      display: flex;
      gap: 1em;
      align-items: center;
      flex-wrap: wrap;
    }

    @media screen and (max-width: 600px) {
      .input-group {
        flex-direction: column;
        align-items: flex-start;
      }

      .input-group label,
      .input-group input {
        width: 100%;
      }
    }

    .table-container,
    .history-container {
      margin-top: 2em;
      max-height: 300px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      background: #fff;
      padding: 1em;
    }

    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 0.5em; text-align: right; }
    th { background-color: #eee; position: sticky; top: 0; }
    caption { text-align: left; font-weight: bold; margin-bottom: 0.5em; }
  </style>
</head>
<body>
  <h1>代行料金計算</h1>
  <div class="input-group">
    <label for="distance">走行距離（km）:</label>
    <input type="number" id="distance" min="0" step="0.1">
    <label for="taxRate">消費税率（%）:</label>
    <input type="number" id="taxRate" min="0" step="0.1" value="10">
  </div>
  <button onclick="calculate()">計算する</button>
  <div class="result" id="result"></div>

  <div class="table-container">
    <table>
      <caption>📊 料金早見表（0〜100km）</caption>
      <thead>
        <tr>
          <th>距離 (km)</th>
          <th>税込料金 (円)</th>
          <th>税抜価格 (円)</th>
          <th>消費税額 (円)</th>
        </tr>
      </thead>
      <tbody id="fareTable"></tbody>
    </table>
  </div>

  <div class="history-container">
    <h2>📝 計算履歴 (一時保存)</h2>
    <b>新しい順</b>
    <table>
      <thead>
        <tr>
          <th>距離 (km)</th>
          <th>税率 (%)</th>
          <th>税込 (円)</th>
          <th>税抜 (円)</th>
          <th>消費税 (円)</th>
        </tr>
      </thead>
      <tbody id="historyTable"></tbody>
    </table>
  </div>

  <script>
    const baseDistance = 4;
    const baseFare = 1200;
    const extraPerKm = 200;

    function calculate() {
      const km = parseFloat(document.getElementById('distance').value);
      const taxRate = parseFloat(document.getElementById('taxRate').value);
      if (isNaN(km) || km < 0 || isNaN(taxRate) || taxRate < 0) {
        document.getElementById('result').textContent = "正しい距離と税率を入力してください。";
        return;
      }

      const extraKm = Math.floor(km) > baseDistance ? Math.floor(km) - baseDistance : 0;
      const total = baseFare + extraKm * extraPerKm;
      const divisor = 1 + (taxRate / 100);
      const cost = Math.floor(total / divisor);
      const tax = total - cost;

      document.getElementById('result').innerHTML = `
        合計料金：${Math.floor(total).toLocaleString()} 円<br>
        └ 税抜価格：${cost.toLocaleString()} 円<br>
        └ 消費税額：${tax.toLocaleString()} 円
      `;

      const historyRow = `<tr>
        <td>${km}</td>
        <td>${taxRate}</td>
        <td>${Math.floor(total).toLocaleString()}</td>
        <td>${cost.toLocaleString()}</td>
        <td>${tax.toLocaleString()}</td>
      </tr>`;
      document.getElementById('historyTable').insertAdjacentHTML('beforeend', historyRow);
    }

    document.addEventListener('keydown', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        calculate();
      }
    });

    function generateTable() {
      const table = document.getElementById('fareTable');
      const taxRate = parseFloat(document.getElementById('taxRate').value);
      const divisor = 1 + (taxRate / 100);
      table.innerHTML = "";

      for (let km = 0; km <= 100; km++) {
        const extraKm = km > baseDistance ? km - baseDistance : 0;
        const total = baseFare + extraKm * extraPerKm;
        const cost = Math.floor(total / divisor);
        const tax = total - cost;
        const row = `<tr>
          <td>${km}</td>
          <td>${Math.floor(total).toLocaleString()}</td>
          <td>${cost.toLocaleString()}</td>
          <td>${tax.toLocaleString()}</td>
        </tr>`;
        table.insertAdjacentHTML('beforeend', row);
      }
    }

    generateTable();
    document.getElementById('taxRate').addEventListener('input', generateTable);
  </script>
</body>
</html>